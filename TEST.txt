import subprocess

def get_fps(video_path: str) -> float:
    """
    ffprobeを使って動画のfpsを取得する
    """
    cmd = [
        "ffprobe", "-v", "0",
        "-of", "csv=p=0",
        "-select_streams", "v:0",
        "-show_entries", "stream=r_frame_rate",
        video_path
    ]
    result = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
    fps_str = result.stdout.strip()
    # 例: "30/1" → 30.0 に変換
    num, den = map(int, fps_str.split("/"))
    return num / den if den != 0 else 0.0


def extract_frame(video_path: str, frame_number: int, output_path: str):
    """
    指定したフレーム番号から画像を切り出す
    """
    fps = get_fps(video_path)
    seconds = frame_number / fps  # 秒数に変換

    # ffmpegコマンドで切り出し
    cmd = [
        "ffmpeg", "-y",  # 上書き
        "-ss", str(seconds),
        "-i", video_path,
        "-frames:v", "1",
        output_path
    ]
    subprocess.run(cmd, check=True)

    print(f"フレーム {frame_number} を秒数 {seconds:.3f}s で切り出しました (fps={fps})")


# --- 使い方 ---
video_file = "input.mp4"
frame_number = 1234
output_file = "frame1234.jpg"

extract_frame(video_file, frame_number, output_file)