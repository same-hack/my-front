from fastapi import FastAPI, UploadFile, Form
from pydantic import BaseModel
from typing import List

class Part(BaseModel):
    partNumber: int
    etag: str

class CompleteRequest(BaseModel):
    filename: str
    uploadId: str
    parts: List[Part]

@app.post("/upload/complete")
async def complete_upload(req: CompleteRequest):
    completed_parts = [
        {"ETag": p.etag, "PartNumber": p.partNumber}
        for p in req.parts
    ]
    s3_client.complete_multipart_upload(
        Bucket=BUCKET_NAME,
        Key=req.filename,
        UploadId=req.uploadId,
        MultipartUpload={"Parts": completed_parts}
    )
    return {"result": "ok", "filename": req.filename}